<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= typeof title !== 'undefined' ? title + ' - ' : '' %><%= restaurantName %></title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <% if (user) { %>
    <nav class="navbar">
        <div class="nav-brand">
            <h2><%= restaurantName %></h2>
        </div>
        <ul class="nav-menu">
            <li><a href="/dashboard">Dashboard</a></li>
            
            <% if (user.role === 'admin' || user.role === 'cashier') { %>
            <li><a href="/pos">Punto de Venta</a></li>
            <li><a href="/cash-register">Caja</a></li>
            <% } %>
            
            <li><a href="/validator">Validador</a></li>
            
            <% if (user.role === 'admin') { %>
            <li><a href="/products">Productos</a></li>
            <li><a href="/users">Usuarios</a></li>
            <li><a href="/reports">Reportes</a></li>
            <% } %>
            
            <% if (user.role === 'admin' || user.role === 'accountant') { %>
            <li><a href="/accounting">Contabilidad</a></li>
            <% } %>
        </ul>
        <div class="nav-user">
            <span class="user-name"><%= user.name %> (<%= user.role %>)</span>
            <button onclick="logout()" class="btn-logout">Cerrar Sesión</button>
        </div>
    </nav>
    <% } %>

    <main class="main-content">
        <%- body %>
    </main>

    <script>
        async function logout() {
            try {
                const response = await fetch('/api/auth/logout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    window.location.href = '/';
                }
            } catch (error) {
                console.error('Error al cerrar sesión:', error);
                alert('Error al cerrar sesión');
            }
        }

        // Función para formatear moneda en PESOS CHILENOS
        function formatCurrency(amount) {
            return new Intl.NumberFormat('es-CL', {
                style: 'currency',
                currency: 'CLP',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }

        // Función auxiliar para formatear fecha
        function formatDate(date) {
            return new Date(date).toLocaleString('es-CL', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Mostrar mensajes de notificación
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.classList.add('show');
            }, 100);

            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
    </script>
</body>
</html>